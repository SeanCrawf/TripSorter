var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),App;!function(a){"use strict";a.name="TripSorter",a.Globals={Events:{ERROR_LOG:"error_log"}},angular.element(document).ready(function(){return angular.bootstrap(document,[a.name])}),angular.module(a.name,["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"pipeline/Routes/TripForm/TripForm.html"}).when("/results",{templateUrl:"pipeline/Routes/TripFormResults/TripFormResults.html"})}]).run(["$store",function(a){return null}])}(App||(App={}));var Store;!function(a){"use strict";a.Events={SET:"STORE_SET",UPDATE:"STORE_UPDATE"};var b=function(){function b(b){var c=this;this.$flux=b,this._store={},this.$flux.subscribe({type:a.Events.SET,action:function(a){return c._set(a)}})}return b.prototype._set=function(b){this._store[b.key]=b.value,this.$flux.dispatch({type:a.Events.UPDATE,payload:b.key})},b.prototype.get=function(a){return this._store[a]},b}();a.StoreService=b,angular.module(App.name).factory("$store",["$flux",function(a){return new b(a)}])}(Store||(Store={}));var App;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(a,b,c){var d=this;this.$scope=a,this.$flux=b,this.$store=c,this._storePrefix="dropdown_",this.$scope.controller=this,this.$scope.options=this.$store.get(this.$scope.storeKey)||[],this.$scope.model=this.$store.get(this._storePrefix+this.$scope.name)||null,this.$flux.subscribe({type:Store.Events.UPDATE,action:function(a){return a===d.$scope.storeKey&&d._getFromStore()}})}return a.prototype._getFromStore=function(){this.$scope.options=this.$store.get(this.$scope.storeKey)},a.prototype.storeValue=function(){this.$flux.dispatch({type:Store.Events.SET,payload:{key:this._storePrefix+this.$scope.name,value:this.$scope.model}})},a}();a.DropdownController=b,a.DropdownControllerExport=["$scope","$flux","$store",function(a,c,d){return new b(a,c,d)}]}(b=a.Dropdown||(a.Dropdown={}))}(b=a.Components||(a.Components={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c;!function(b){"use strict";angular.module(a.name).directive("dropdown",function(){return{replace:!0,templateUrl:"pipeline/Components/Dropdown/Dropdown.html",scope:{name:"@",storeKey:"@",placeholder:"@",model:"="},controller:b.DropdownControllerExport}})}(c=b.Dropdown||(b.Dropdown={}))}(b=a.Components||(a.Components={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(b,c,d){var e=this;this.$scope=b,this.$flux=c,this.$timeout=d,this._lifeTick=500,this.$scope.controller=this,this.$scope.messages=[],this.$flux.subscribe({type:a.Globals.Events.ERROR_LOG,action:function(a){return e.addMessage(a)}})}return b.prototype.lifeTicks=function(){var a=this,b=[];this.$scope.ticking=!0,this.$scope.messages.forEach(function(c){c.life-=a._lifeTick,c.life>0&&b.push(c)}),this.$scope.messages=b,this.$scope.messages.length>0?this.$timeout(function(){return a.lifeTicks()},this._lifeTick):this.$scope.ticking=!1},b.prototype._messageExists=function(a){for(var b=0;b<this.$scope.messages.length;b++)if(this.$scope.messages[b].message==a)return!0;return!1},b.prototype.addMessage=function(a,b){void 0===b&&(b="danger");var c={message:a,life:6e3,type:b};!this._messageExists(a)&&this.$scope.messages.push(c),this.$scope.ticking||this.lifeTicks()},b}();b.UIMessageController=c,b.UIMessageControllerExport=["$scope","$flux","$timeout",function(a,b,d){return new c(a,b,d)}]}(c=b.UIMessage||(b.UIMessage={}))}(b=a.Components||(a.Components={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c;!function(b){"use strict";angular.module(a.name).directive("uiMessage",function(){return{replace:!0,transclude:!0,templateUrl:"pipeline/Components/UIMessage/UIMessage.html",scope:{},controller:b.UIMessageControllerExport}})}(c=b.UIMessage||(b.UIMessage={}))}(b=a.Components||(a.Components={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c=function(){function a(a,b,c){this.$scope=a,this.$flux=b,this.$location=c,this.$scope.controller=this}return a}();b.RouteController=c,angular.module(a.name).controller("Routes.RouteController",["$scope","$flux","$location",function(a,b,d){return new c(a,b,d)}])}(b=a.Routes||(a.Routes={}))}(App||(App={}));var TripSorter;!function(a){"use strict";var b=function(){function a(a){this._transport=a.transport,this._arrival=a.arrival,this._departure=a.departure,this._duration=a.duration,this._cost=a.cost,this._discount=a.discount,this._reference=a.reference}return Object.defineProperty(a.prototype,"transport",{get:function(){return this._transport},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"arrival",{get:function(){return this._arrival},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"departure",{get:function(){return this._departure},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cost",{get:function(){return this._cost},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"discount",{get:function(){return this._discount},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"reference",{get:function(){return this._reference},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"durationInMins",{get:function(){return 60*parseInt(this._duration.h)+parseInt(this._duration.m)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"costAfterDiscount",{get:function(){return parseInt(this._cost*(100-this._discount)+"")/100},enumerable:!0,configurable:!0}),a}();a.Deal=b}(TripSorter||(TripSorter={}));var TripSorter;!function(a){"use strict";var b=function(){function b(a){this._name=a.name,this._deals=a.deals||{}}return Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"deals",{get:function(){return this._deals},enumerable:!0,configurable:!0}),b.prototype.addDeal=function(b,c){this._deals[b]=new a.Deal(c)},b}();a.City=b}(TripSorter||(TripSorter={}));var TripSorter;!function(a){"use strict";a.Keys={RESULTS:"tripsorter_results"};var b=function(){function b(a,b){this.$http=a,this.$flux=b,this._cities={},this._deals={},this._loadFromJson()}return Object.defineProperty(b.prototype,"cities",{get:function(){return this._cities},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"deals",{get:function(){return this._deals},enumerable:!0,configurable:!0}),b.prototype._loadFromJson=function(){var a=this;this.$http({method:"GET",url:"api/response.json"}).then(function(b){a.addCitiesAndDeals(b),a.$flux.dispatch({type:Store.Events.SET,payload:{key:"cities",value:_.sortBy(Object.keys(a._cities),function(a){return a})}})})},b.prototype.addCitiesAndDeals=function(b){var c=this;b.data.deals.forEach(function(b){c.cityExists(b.departure)||(c._cities[b.departure]=new a.City(b.departure)),c.cityExists(b.arrival)||(c._cities[b.arrival]=new a.City(b.arrival)),c._cities[b.departure].addDeal(b.reference,b),c._deals[b.reference]=new a.Deal(b)})},b.prototype.cityExists=function(a){return"undefined"!=typeof this._cities[a]},b.prototype.shortestPath=function(a,b,c){if(!this.cityExists(a))return this._makeError("The departure City does not exist!");if(!this.cityExists(b))return this._makeError("The arrival City does not exist!");for(var d=this._createJourneyNodes(null,c,a),e=!1;!e;){var f=this._getLowestTotalJourney(d);if(f.route[0]==a&&f.route[f.route.length-1]==b)return e=!0,f;if(this._createJourneyNodes(f,c).forEach(function(a){d.push(a)}),d.splice(d.indexOf(f),1),0==d.length)return e=!0,this._makeError("No routes meet your search criteria!")}},b.prototype._createJourneyNodes=function(a,b,c){void 0===a&&(a=null),void 0===c&&(c=null);var d=[],e=null===a?c:a.route[a.route.length-1];for(var f in this._cities[e].deals){var g=this._cities[e].deals[f],h=null!==a?_.clone(a.route):[],i=null!==a?_.clone(a.deals):[],j=null!==a?_.clone(a.total):0;null!==c&&0==h.length&&h.push(c),-1===h.indexOf(g.arrival)&&(h.push(g.arrival),i.push(g.reference),j+=this._deals[g.reference][b],d.push({route:h,deals:i,total:j}))}return d},b.prototype._getLowestTotalJourney=function(a){void 0===a&&(a=[]);for(var b,c=0;c<a.length;c++)("undefined"==typeof b||a[c].total<b.total)&&(b=a[c]);return b},b.prototype._makeError=function(a){return{message:a}},b}();a.TripSorterService=b,angular.module(App.name).factory("$tripSorter",["$http","$flux",function(a,c){return new b(a,c)}])}(TripSorter||(TripSorter={}));var App;!function(a){var b;!function(b){var c;!function(c){var d=function(b){function c(a,c,d,e,f){var g=b.call(this,a,c,d)||this;if(g.$store=e,g.$tripSorter=f,g._searchTypes={Cheapest:{unit:"costAfterDiscount",active:!0},Fastest:{unit:"durationInMins"}},g.$scope.controller=g,g.$scope.model={},g.$scope.searchTypes=g._searchTypes,g.$scope.currentSearchType=g.$store.get("search_type")||!1,!g.$scope.currentSearchType)for(var h in g._searchTypes)g._searchTypes[h].active&&g.setSearchType(h);return g}return __extends(c,b),c.prototype.setSearchType=function(a){"undefined"!=typeof this._searchTypes[a]&&(this.$scope.currentSearchType=a,this.$flux.dispatch({type:Store.Events.SET,payload:{key:"search_type",value:a}}))},c.prototype.searchRoute=function(){var b=this.$scope.model.from,c=this.$scope.model.to,d=this._searchTypes[this.$scope.currentSearchType].unit;if(null===b||""===b||null===c||""===c)return void this.$flux.dispatch({type:a.Globals.Events.ERROR_LOG,payload:"Please select both a city you wish to depart from and a destination!"});if(b===c)return void this.$flux.dispatch({type:a.Globals.Events.ERROR_LOG,payload:"The city you wish to depart from must be different than the destination!"});var e=this.$tripSorter.shortestPath(b,c,d);this.$flux.dispatch({type:Store.Events.SET,payload:{key:TripSorter.Keys.RESULTS,value:e}}),e.deals&&e.deals.length>0?this.$location.path("/results"):this.$flux.dispatch({type:a.Globals.Events.ERROR_LOG,payload:e.message})},c}(b.RouteController);c.TripFormController=d,angular.module(a.name).controller("Routes.TripFormController",["$scope","$flux","$location","$store","$tripSorter",function(a,b,c,e,f){return new d(a,b,c,e,f)}])}(c=b.TripForm||(b.TripForm={}))}(b=a.Routes||(a.Routes={}))}(App||(App={}));var App;!function(a){var b;!function(b){var c;!function(c){var d=function(a){function b(b,c,d,e,f){var g=a.call(this,b,c,d)||this;return g.$store=e,g.$tripSorter=f,g.$scope.controller=g,g.$scope.results=g.$store.get(TripSorter.Keys.RESULTS)||!1,g._validateResults(),g}return __extends(b,a),b.prototype._validateResults=function(){this.$scope.results||this.$location.path("/"),this.$scope.total=0,this.$scope.duration={h:0,m:0},this.$scope.deals=[];for(var a in this.$scope.results.deals){var b=this.getDeal(this.$scope.results.deals[a]);this.$scope.deals.push(b),this.$scope.duration.h+=parseInt(b.duration.h),this.$scope.duration.m+=parseInt(b.duration.m),this.$scope.total+=b.costAfterDiscount}this.$scope.duration.h+=Math.floor(this.$scope.duration.m/60),this.$scope.duration.m=this.$scope.duration.m%60,this.$scope.duration.h=("0"+this.$scope.duration.h).slice(-2),this.$scope.duration.m=("0"+this.$scope.duration.m).slice(-2)},b.prototype.getDeal=function(a){return new TripSorter.Deal(this.$tripSorter.deals[a])},b.prototype.reset=function(){this.$location.path("/")},b}(b.RouteController);c.TripFormResultsController=d,angular.module(a.name).controller("Routes.TripFormResultsController",["$scope","$flux","$location","$store","$tripSorter",function(a,b,c,e,f){return new d(a,b,c,e,f)}])}(c=b.TripFormResults||(b.TripFormResults={}))}(b=a.Routes||(a.Routes={}))}(App||(App={}));var Flux;!function(a){"use strict";var b=function(){function a(){this._subscriptions={}}return Object.defineProperty(a.prototype,"subscriptions",{get:function(){return this._subscriptions},enumerable:!0,configurable:!0}),a.prototype._dispatch=function(a){return this._subscriptions[a.type]&&this._subscriptions[a.type].forEach(function(b){b(a.payload)}),this},a.prototype.dispatch=function(a){if(a.constructor!==Array)return this._dispatch(a);for(var b in a)this._dispatch(a[b]);return this},a.prototype._subscribe=function(a){return(this._subscriptions[a.type]=this._subscriptions[a.type]||[]).push(a.action),this},a.prototype.subscribe=function(a){if(a.constructor!==Array)return this._subscribe(a);for(var b in a)this._subscribe(a[b]);return this},a}();a.Dispatcher=b,angular.module(App.name).factory("$flux",[function(){return new b}])}(Flux||(Flux={})),angular.module(App.name).run(["$templateCache",function(a){"use strict";a.put("pipeline/Components/Dropdown/Dropdown.html",'<div class="form-group"> <select class="form-control" name="{{ name }}" ng-model="model" ng-change="controller.storeValue()"> <option value="" hidden>{{ options.length > 0 ? placeholder : \'Loading...\' }}</option> <option value="{{ option }}" ng-repeat="option in options">{{ option }}</option> </select> </div>'),a.put("pipeline/Components/UIMessage/UIMessage.html",'<div class="ui-message-container"> <div class="alert alert-danger" ng-class="{ \'active\': msgObj.life > 1000 }" ng-repeat="msgObj in messages"> {{ msgObj.message }} </div> </div>'),a.put("pipeline/Routes/TripForm/TripForm.html",'<div ng-controller="Routes.TripFormController"> <div ng-form name="tripsorter"> <div dropdown name="from" placeholder="From" store-key="cities" model="model.from"></div> <div dropdown name="to" placeholder="To" store-key="cities" model="model.to"></div> <div class="form-group"> <div class="btn-group btn-group-justified"> <div class="btn btn-default" ng-repeat="(key, searchType) in searchTypes" ng-class="{ \'btn-info\': currentSearchType === key }" ng-click="controller.setSearchType(key)">{{ key }}</div> </div> </div> <div class="form-group"> <button class="btn btn-success btn-block" ng-click="controller.searchRoute()"><i class="glyphicon glyphicon-search"></i> Search</button> </div> </div> </div>'),a.put("pipeline/Routes/TripFormResults/TripFormResults.html",'<div ng-controller="Routes.TripFormResultsController"> <div class="bg-info v-margin" ng-repeat="deal in deals"> <div class="col-xs-12 col-spacing"> <table style="width: 100%"> <tr> <td> <div class="margin-bottom">{{ deal.departure }} <i class="glyphicon glyphicon-chevron-right"></i> {{ deal.arrival }}</div> <div class="margin-bottom"><span class="label label-default">{{ deal.transport }}</span> <small>{{ deal.reference }} for {{ deal.duration.h }}hrs {{ deal.duration.m }}mins</small></div> </td> <td class="text-right"> <div> <span class="h4 no-margin"><strong>&euro;{{ deal.costAfterDiscount }}</strong> </span></div> <div ng-show="deal.cost > deal.costAfterDiscount"> <small class="text-danger"><s>&euro;{{ deal.cost }}</s></small> </div> </td> </tr> </table> </div> <div class="clearfix"></div> </div> <div class="bg-primary v-margin margin-bottom-lg"> <div class="col-xs-12 col-spacing text-center"> <table style="width: 100%"> <tr> <td class="text-left">Total</td> <td class="text-center">{{ duration.h }}hrs {{ duration.m }}mins</td> <td class="text-right h3"><strong>&euro; {{ total }}</strong></td> </tr> </table> </div> <div class="clearfix"></div> </div> <div class="form-group"> <button class="btn btn-success btn-block" ng-click="controller.reset()"><i class="glyphicon glyphicon-retweet"></i> Reset</button> </div> </div>')}]);